Hands on: Multi document Agents
================================


![image](https://github.com/user-attachments/assets/7fb9878e-cf29-4c16-95c9-6bf0069ad652)

- Main motivating factor is we can decouple the embedding retrievers with the chunk based document summary
  retrievers.
- Essentially for each document we have
    1) semantic retriever - based on vector embeddings.
    2) Document summary Retriever - based on the summary of the nodes.
-  for Any given query we can actually choose which retriever to use for which document.
   that choice is actually doing by document Agent.


  Step 1: Setup:
  ==============

  ![image](https://github.com/user-attachments/assets/c453928e-6ded-45f6-b6d8-9a30f6d12157)



  Step 2: Download Data:
  =======================

  ![image](https://github.com/user-attachments/assets/f0518340-1352-4e28-8d23-279f3170d6e3)

    important necessary modules
    
  Step 3: list of cities:
  =======================

  ![image](https://github.com/user-attachments/assets/9da06f77-d1c9-4c7d-95b4-9a33d9718585)

  - iterate over wikipedia titles list
  - save the wikipedia text by the name of the same city like mumbai.txt

  Step 4: load to dictionary:
  ============================

  ![image](https://github.com/user-attachments/assets/1a9897e8-2554-4f98-9e25-39bfe0160da5)

    - dump all the five cities to dictionary
    

  Step 5: Define LLM (callback) manager:
  =======================================


    - 2agent for each of document.
    - we create for each document 2 index ( document index  , vector index)
    - we have 2 index for each cities.


  ![image](https://github.com/user-attachments/assets/4341b901-c343-49eb-afd1-6cfb77b28d19)

    build agent dictionary


 ![image](https://github.com/user-attachments/assets/764633c9-4e30-4e31-a8c9-12c1592aebaa)

![image](https://github.com/user-attachments/assets/f7b58a20-6de7-497f-ba41-84b06c951fc0)


Agent dictionary has cities name.

![image](https://github.com/user-attachments/assets/0b994f52-7a31-4195-9ff3-7d1beeb30482)

- ultimately result is dictionary called agent where key = **city_name** value is **<<openAI Agent>>**

![image](https://github.com/user-attachments/assets/61b58ba4-92c4-4516-90d1-6863dea16b91)



Step 6: Recursive agent over agent:
====================================
now we build recursive agent over these agents.

![image](https://github.com/user-attachments/assets/5764a16c-0c78-4882-95e2-55e20c09f957)

- index nodes will represent each city.
- we define the top level retriever , this creates a vector index of the top level nodes
  and a retriever that will retrieve the most similar nodes for each of these cities.
  ![image](https://github.com/user-attachments/assets/f30de35f-611d-4bc6-be8a-55e7821a4b9e)

- now setting up recursive retriever that first toplevel vector retriever to find the relevant city
  and then it uses the city specific agent to answer the query.
- define full query engine which is **Recursive retriever + response synthesizer**

  ![image](https://github.com/user-attachments/assets/d2a114a0-03f2-462b-a92c-52e87402336f)


Step 7: Run QUery:
==================

![image](https://github.com/user-attachments/assets/528809d0-b72f-4ffc-b9dc-275d28993151)


 - it goes in recursive mode and try to find out which document agent must be used.
 - here it says retrieved node with id - which node was retrieved - index node - so index node
   named "delhi" was retrieved . from there it trigger the summary index from there i was able to
   get the entire summary.

   ![image](https://github.com/user-attachments/assets/a71acf72-e027-4900-b23d-1536c621c662)

 system work flow :

   1) top level retriever identifies which city query belongs
   2) The recursive retriever then uses the appropriate city - specific agent to answer the query.
   3) The response synthesis compacts the answer into a coherent response.

      ![image](https://github.com/user-attachments/assets/bd3f7b74-1f9b-4c2e-a339-1b9d27cdeef8)

      ![image](https://github.com/user-attachments/assets/1d3e010f-8063-4c64-b37f-ee88d7e6fbda)

      ![image](https://github.com/user-attachments/assets/87888368-aaca-405b-87dd-9fcc252cc530)

final response which got generated.
       
