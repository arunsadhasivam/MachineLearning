Hands on: Hybrid Fusion Retriever
==================================




1)Reciprocal Rerank Fusion Retriever:
=====================================

![image](https://github.com/user-attachments/assets/7f9ba94e-f288-44d5-a444-9bf867121fef)

- it outperforms the classical vector store retrieval techniques as per document.

Step 1: Setup:
==============

![image](https://github.com/user-attachments/assets/d3db540c-d5d1-40c3-91cb-b389ef840546)


Step 2: Download data:
========================

![image](https://github.com/user-attachments/assets/5aea79f9-330a-4c4c-874c-f5d34ac41cd3)


Step 3: load data:
====================

![image](https://github.com/user-attachments/assets/a5659985-69f2-4ab1-8c1c-9a72d7062951)


Step 4: vector store index:
============================


![image](https://github.com/user-attachments/assets/23191cc1-5f6a-4438-9968-ee551d5a9fa1)


 - build vector store index

Step 4: vector store index:
============================

  - create 2 types of retriever
     1) retriever for above vector store index - retriever top k similar nodes based on vector similarity
     2) BM25Retrieval   Function               - retriever uses keyword search term frequency.
  - here uses 2 search vector similarity and keyword search functionality search from BM25Retrieval Algorithm.
     both these 2 retrieved nodes are ranked.

    ![image](https://github.com/user-attachments/assets/6d546226-426e-49e8-8679-a6859cb46ad4)

    - prompt which is used, this prompt which is used by keywordsearch(BM25) and not needed for
      vector store index.

    ![image](https://github.com/user-attachments/assets/f5e5bb15-a49a-4b69-81f9-979ba6e37cc9)

 Step 5: Bm25 Retriever:
========================= 
     - Bm25 we use raw chunks(doc_store).
     - positional encodings
   
   ![image](https://github.com/user-attachments/assets/65e2b677-2cb7-42fe-8506-f6705ee1bf93)

     top2 nodes from vector store index above

    - Another query engine 1 for Bm25 and same query engine passed to bm25 retriever engine.
      response is similar to vector search index.

   ![image](https://github.com/user-attachments/assets/fd0ea56e-c1d4-4082-a00a-59e2b1aac219)


   ![image](https://github.com/user-attachments/assets/e43fc97f-d5ec-407a-b04f-6710a5b5b45c)

   Summary:
   ========

   - top most chunk is same in both vector and bm25 retriever

   ![image](https://github.com/user-attachments/assets/551d834b-e720-4621-ac47-80d70b89f960)
    above is raw nodes from bm25

 Step 6: FusionRetriever:
============================   

   ![image](https://github.com/user-attachments/assets/e17749b0-7a0b-4fe1-8fb3-c7c05701e908)


    - top2 coming from vector retriever and 2 from BM25 retriever
    - top2 out of the 4 will be retrieved.

   ![image](https://github.com/user-attachments/assets/500f6298-401e-42dd-a15b-3764688105e5)


    3 questions are required for re-ranking.

   ![image](https://github.com/user-attachments/assets/94672864-2d98-44c6-aae2-0ee43a8aea7f)

    - top 2 comes from BM25 retriever (page 2, page11)
    - since page 2 is common in both retriever so fusion retriever rank in their final result.
    - rank first by fusion retriever.
    
 Step 7: QueryEngine:
=======================

![image](https://github.com/user-attachments/assets/723eca23-68c3-408e-ac22-92f56b203624)


  - create query fusion engine by passing query fusion retriever
