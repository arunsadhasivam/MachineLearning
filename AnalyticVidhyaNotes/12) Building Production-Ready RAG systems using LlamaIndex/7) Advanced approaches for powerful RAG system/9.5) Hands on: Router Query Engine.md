![image](https://github.com/user-attachments/assets/c21ff6bf-3627-4699-bb4c-b0062744c56e)Hands on: Router Query Engine
=============================


Main purpose of Router:
=======================

    - Routers are specialized modules in a system that has primarily 2 functions.
      1) to process user queries 
      2) it will select from a set of pre-defined choices. these choices are characterized by
         their metadata which means that each choice has associated information that describes its
         purpose and the content.

Two types of router Modules:
============================

    1) LLM Selector 
    2) Pydantic Selectors 

    - Main difference between these 2 types is how they process and structure these choices and results.
    - llm selectors works with natural language and they use llm understanding to make these selections.
    - pydantic works on structure data and uses predefined schemas to validate and process these choices and result.

Step 1: Setup:
==============

![image](https://github.com/user-attachments/assets/cca5f4c7-800e-4648-bb96-ef724e1e9c09)

![image](https://github.com/user-attachments/assets/c7233160-95a4-4a09-acfb-6efd3ffc3f75)

setup logging system and import necessary libraries and classes

Step 2: import libraries needed:
================================

![image](https://github.com/user-attachments/assets/39b2e764-4b07-490e-aeb9-8ab2ed151cae)


Step 3: Download data:
======================

![image](https://github.com/user-attachments/assets/f70f4524-5931-4471-9130-0b4b059df524)


Step 4:load data:
=================

![image](https://github.com/user-attachments/assets/99a2c257-5deb-4a51-913c-4cb20d702f6a)


Step 5:Define Summary index and vector index over some data:
=============================================================

![image](https://github.com/user-attachments/assets/c93c5ae0-4790-43d7-b7a4-5410d9c24673)


Step 6:Define Summary index and vector index over some data:
=============================================================


 ![image](https://github.com/user-attachments/assets/308b6fc8-aaef-4c8c-9af0-7eee7268e39a)


  - for **summary**  , summary index is more appropriate over vector index but however inorder to fetch
    more **specific information or facts** then vector index is more relevant like "who won world cup"


Step 7:Individual queryEngine for summary and vector :
=======================================================

![image](https://github.com/user-attachments/assets/dc966063-7964-4b0a-aa0c-83fa75ff1e73)

 - summary index store summary for each of the node . when query more generic when search over
   entire document  like document summary for that summary index is more appropriate.
 - to fetch specific information some facts vector index is more relevant.
 
 - index are created
 - now create individual queryEngine.
 - response mode choosen is "tree_summarize" experiment with "refined","compact" mode.

Step 8:Build SummaryIndex and vector index tools :
===================================================

![image](https://github.com/user-attachments/assets/fcf38a1d-bbea-4453-8b67-92f825cb215e)

  - now query Engine set.
  - now use queryEngineTools to query Individual queryEngines that we created.
  - these queryEngines will serve as a router,it will identify which queryENgine should be
    used for what user query. that is the use of queryEngine tools.
  - first build the summary index tool, then vector index tool and then combine these tools
    by using Router.
   - also add descriptions, which helps router to choose which queryEngine to be used. 


Step 9:Define Router QUery Engine:
===================================

 ![image](https://github.com/user-attachments/assets/d571dad5-c679-4e20-b8d9-d2404ea176ae)

 

 - choose selector we can use llm or pydantic

   ![image](https://github.com/user-attachments/assets/e46c2272-dbe8-4cbe-ae53-6f185498078f)

  - now setting up the router query Engine by passing tools
  - "summary_tool" - query Engine for summary index.
  - "vector_tool" - query Engine for vector store index.
  - providing is the list of queryEngine tools.
  - these queryEngine has been wrapped in tools.

    ![image](https://github.com/user-attachments/assets/d53efad3-70f6-4b89-b6da-8880bc4d9315)

 - summary of the document.

Step 10:LLMSingle Selector:
===========================
    
      - just replace the pydantic selector by llm
      
   ![image](https://github.com/user-attachments/assets/bb58ba83-7e46-4f93-9e6a-7c5c86bc7d6d)
   ![image](https://github.com/user-attachments/assets/723df7c2-58b3-428a-9bf6-bb741355f6f1)

   ![image](https://github.com/user-attachments/assets/06154ad5-136c-4423-b17a-98f2224252ba)

Step 11:PydanticMultiSelector:
================================

   - if anticipate the query to be directed to multiple indexes. it is advisable to use multi selector.
   - this selector dispatches the query to various sub-indexes and subsequently aggregates the response.

     ![image](https://github.com/user-attachments/assets/c01621d7-37b7-49c9-8b42-4cda6c34d863)


     ![image](https://github.com/user-attachments/assets/24c5f585-7799-4e73-aac8-914e7827842f)


     ![image](https://github.com/user-attachments/assets/fd3b4748-fcaf-428e-b6f3-b4c597151db7)
